#!/bin/bash

# ç†æƒ³æ±½è½¦è®¢å•ç›‘æŽ§ - å®šæœŸé€šçŸ¥åŠŸèƒ½æµ‹è¯•è„šæœ¬

echo "ðŸš— ç†æƒ³æ±½è½¦è®¢å•ç›‘æŽ§ - å®šæœŸé€šçŸ¥åŠŸèƒ½æµ‹è¯•"
echo "================================================"
echo ""

# æ£€æŸ¥é…ç½®æ–‡ä»¶
if [ ! -f "config.yaml" ]; then
    echo "âš ï¸  é…ç½®æ–‡ä»¶ config.yaml ä¸å­˜åœ¨ï¼Œåˆ›å»ºç¤ºä¾‹é…ç½®..."
    cat > config.yaml << EOF
# ç†æƒ³æ±½è½¦è®¢å•ç›‘æŽ§é…ç½®
order_id: "177971759268550919"
check_interval: "@every 5m"  # æµ‹è¯•æ—¶ä½¿ç”¨è¾ƒçŸ­é—´éš”

# å®šæœŸé€šçŸ¥é…ç½®
enable_periodic_notify: true           # å¯ç”¨å®šæœŸé€šçŸ¥
notification_interval_hours: 1         # æµ‹è¯•æ—¶è®¾ç½®ä¸º1å°æ—¶
always_notify_when_approaching: true   # ä¸´è¿‘äº¤ä»˜æ—¶æ€»æ˜¯é€šçŸ¥

# ç†æƒ³æ±½è½¦APIé…ç½®
lixiang_cookies: ""  # éœ€è¦ä»Žæµè§ˆå™¨èŽ·å–

# é€šçŸ¥é…ç½® (è‡³å°‘é…ç½®ä¸€ä¸ª)
serverchan_sendkey: ""     # Serveré…±çš„SendKey
wechat_webhook_url: ""     # å¾®ä¿¡ç¾¤æœºå™¨äººWebhook URL

# é¢„è®¡äº¤ä»˜é…ç½®
lock_order_time: "2024-09-27 13:08:00"  # é”å•æ—¶é—´
estimate_weeks_min: 7                   # æœ€å°‘é¢„è®¡å‘¨æ•°
estimate_weeks_max: 9                   # æœ€å¤šé¢„è®¡å‘¨æ•°
EOF
    echo "âœ… å·²åˆ›å»ºç¤ºä¾‹é…ç½®æ–‡ä»¶ config.yaml"
    echo "ðŸ“ è¯·æ ¹æ®å®žé™…æƒ…å†µä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­çš„å‚æ•°"
    echo ""
fi

echo "ðŸ“‹ å½“å‰é…ç½®éªŒè¯:"
echo "- æ£€æŸ¥é…ç½®æ–‡ä»¶æ˜¯å¦å­˜åœ¨: $([ -f config.yaml ] && echo 'âœ…' || echo 'âŒ')"
echo "- ç¼–è¯‘å¯æ‰§è¡Œæ–‡ä»¶..."

# ç¼–è¯‘ç¨‹åº
if go build -o lixiang-monitor main.go; then
    echo "âœ… ç¼–è¯‘æˆåŠŸ"
else
    echo "âŒ ç¼–è¯‘å¤±è´¥"
    exit 1
fi

echo ""
echo "ðŸ”§ æ–°å¢žåŠŸèƒ½è¯´æ˜Ž:"
echo "1. â° å®šæœŸé€šçŸ¥åŠŸèƒ½"
echo "   - å¯é…ç½®é€šçŸ¥é—´éš” (notification_interval_hours)"
echo "   - å³ä½¿äº¤ä»˜æ—¶é—´æœªæ›´æ–°ä¹Ÿä¼šå®šæœŸå‘é€çŠ¶æ€æŠ¥å‘Š"
echo ""
echo "2. ðŸŽ¯ æ™ºèƒ½é€šçŸ¥ç­–ç•¥"
echo "   - ä¸´è¿‘äº¤ä»˜æ—¶é—´è‡ªåŠ¨æé†’"
echo "   - æ”¯æŒé…ç½®æ˜¯å¦æ€»æ˜¯åœ¨ä¸´è¿‘æ—¶é€šçŸ¥"
echo ""
echo "3. ðŸ“Š å¢žå¼ºçš„é€šçŸ¥å†…å®¹"
echo "   - è¯¦ç»†çš„äº¤ä»˜çŠ¶æ€åˆ†æž"
echo "   - è¿›åº¦ç™¾åˆ†æ¯”æ˜¾ç¤º"
echo "   - æ™ºèƒ½çš„æ—¶é—´çŠ¶æ€åˆ¤æ–­"
echo ""
echo "ðŸ“ ç›¸å…³é…ç½®æ–‡ä»¶:"
echo "   config.yaml              - ä¸»é…ç½®æ–‡ä»¶"
echo "   DELIVERY_OPTIMIZATION.md - ä¼˜åŒ–åŠŸèƒ½è¯¦ç»†è¯´æ˜Ž"
echo ""
echo "ðŸš€ å¯åŠ¨ç›‘æŽ§æœåŠ¡:"
echo "   ./lixiang-monitor"
echo ""
echo "æ³¨æ„ï¼šé¦–æ¬¡è¿è¡Œæ—¶è¯·ç¡®ä¿å·²æ­£ç¡®é…ç½®ï¼š"
echo "1. ç†æƒ³æ±½è½¦ç½‘ç«™çš„ cookies"
echo "2. è‡³å°‘ä¸€ä¸ªé€šçŸ¥æ¸ é“ (ServerChan æˆ–å¾®ä¿¡æœºå™¨äºº)"
echo "3. æ­£ç¡®çš„é”å•æ—¶é—´å’Œé¢„è®¡äº¤ä»˜å‘¨æ•°"