# Web 管理界面功能

## 概述

理想汽车订单监控系统提供了一个简洁美观的 Web 可视化管理界面，让您可以通过浏览器实时查看监控状态和历史记录。

## 功能特性

### ✅ 核心功能

1. **实时统计展示**
   - 总检查次数
   - 时间变更次数
   - 通知发送次数
   - 最后检查时间
   - 监控天数统计

2. **最新状态面板**
   - 当前预计交付时间
   - 锁单时间信息
   - 临近交付状态
   - 最后检查时间
   - 临近提示信息

3. **时间变更历史**
   - 检查时间
   - 旧预计时间
   - 新预计时间
   - 通知状态

4. **历史检查记录**
   - 检查时间列表
   - 预计交付时间
   - 临近交付标记
   - 时间变化标记
   - 通知状态

5. **自动刷新**
   - 每 30 秒自动刷新数据
   - 无需手动刷新页面

## 配置说明

### config.yaml 配置

```yaml
# Web 管理界面配置
web_enabled: true       # 是否启用 Web 界面
web_port: 8080          # Web 服务器端口
```

**配置项说明**：

- `web_enabled`: 控制是否启用 Web 界面
  - `true`: 启用（默认）
  - `false`: 禁用，不启动 Web 服务器

- `web_port`: Web 服务器监听端口
  - 默认: `8080`
  - 范围: 1-65535
  - 建议: 8080, 8000, 3000 等常用端口

## 使用方法

### 1. 启动服务

确保配置文件中 `web_enabled: true`，然后启动程序：

```bash
./lixiang-monitor
```

启动日志会显示：
```
✅ Web 服务器初始化成功
[Web] 启动 Web 服务器: http://localhost:8080
```

### 2. 访问界面

打开浏览器访问：

```
http://localhost:8080
```

如果部署在服务器上，将 `localhost` 替换为服务器 IP：

```
http://your-server-ip:8080
```

### 3. 界面使用

界面分为四个主要区域：

#### 📊 统计卡片区
显示监控的关键指标，包括：
- 总检查次数（高亮显示）
- 时间变更次数
- 通知发送次数
- 最后检查时间

#### 📈 最新状态区
展示当前订单的最新状态：
- 预计交付时间
- 锁单时间
- 临近交付状态
- 最后检查时间
- 临近提示（如果有）

#### 🔄 时间变更历史
列表展示交付时间的历史变化：
- 变化时间
- 原预计时间
- 新预计时间
- 是否发送通知

#### 📝 最近检查记录
展示最近 20 次检查的详细记录。

## API 接口

Web 界面提供了 RESTful API 接口，可用于自定义开发。

### 1. 获取统计数据

**接口**: `GET /api/stats`

**响应示例**:
```json
{
  "total_records": 25,
  "time_changed_count": 3,
  "notification_count": 12,
  "latest_check_time": "2025-10-23 16:49:45",
  "latest_estimate": "预计6-8周内交付",
  "first_check_time": "2025-10-23 08:00:00",
  "monitoring_days": 15,
  "latest_record": {
    "id": 25,
    "order_id": "177971759268550919",
    "estimate_time": "预计6-8周内交付",
    "is_approaching": false,
    ...
  }
}
```

### 2. 获取历史记录

**接口**: `GET /api/records?limit=20`

**参数**:
- `limit`: 返回记录数量（默认 20）

**响应**: 记录数组

### 3. 获取时间变更记录

**接口**: `GET /api/time-changes?limit=10`

**参数**:
- `limit`: 返回记录数量（默认 10）

**响应**: 时间变更记录数组

## 界面截图

### 主界面
- 渐变背景设计
- 响应式布局
- 卡片式信息展示
- 现代化 UI 风格

### 功能特色
- ✨ 美观的渐变配色
- 📱 移动端适配
- 🎨 卡片悬浮效果
- 🏷️ 状态徽章标识
- ⚡ 实时数据更新

## 性能优化

### 自动刷新机制
- 页面加载时立即获取数据
- 每 30 秒自动刷新一次
- 异步加载，不阻塞用户操作

### 数据展示优化
- 分页显示历史记录
- 限制单次查询数量
- 优化数据库查询性能

## 安全建议

### 1. 网络安全

如果部署在公网服务器：

```bash
# 使用防火墙限制访问
sudo ufw allow from 192.168.1.0/24 to any port 8080

# 或使用 nginx 反向代理并添加认证
```

### 2. Nginx 反向代理示例

```nginx
server {
    listen 80;
    server_name monitor.yourdomain.com;
    
    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        
        # 基础认证
        auth_basic "Restricted Access";
        auth_basic_user_file /etc/nginx/.htpasswd;
    }
}
```

### 3. 修改端口

如果需要使用其他端口，修改 `config.yaml`:

```yaml
web_port: 9090  # 使用自定义端口
```

## 故障排查

### Web 服务器无法启动

**症状**:
```
⚠️  Web 服务器初始化失败: ...
```

**解决方法**:
1. 检查端口是否被占用
   ```bash
   lsof -i :8080
   ```

2. 修改为其他端口
   ```yaml
   web_port: 8081
   ```

3. 检查数据库是否初始化成功（Web 依赖数据库）

### 页面无法访问

**症状**: 浏览器无法打开页面

**解决方法**:
1. 确认服务器是否运行
   ```bash
   ps aux | grep lixiang-monitor
   ```

2. 检查防火墙设置
   ```bash
   # macOS
   sudo pfctl -s rules
   
   # Linux
   sudo ufw status
   ```

3. 确认端口正确
   ```bash
   netstat -an | grep 8080
   ```

### API 返回错误

**症状**: API 接口返回错误数据

**解决方法**:
1. 检查数据库文件是否存在
   ```bash
   ls -lh lixiang-monitor.db
   ```

2. 查看日志输出
   ```bash
   tail -f /tmp/lixiang-monitor.log
   ```

## 浏览器兼容性

支持的浏览器：
- ✅ Chrome 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Edge 90+
- ✅ 移动端浏览器

不支持：
- ❌ IE 11 及更早版本

## 技术实现

### 后端技术栈
- **语言**: Go 1.21+
- **路由**: net/http (标准库)
- **模板**: html/template (标准库)
- **嵌入**: embed (Go 1.16+ 特性)

### 前端技术栈
- **HTML5 + CSS3**
- **原生 JavaScript (ES6+)**
- **Fetch API**
- **响应式布局 (Grid + Flexbox)**

### 架构特点
- 单页应用 (SPA)
- RESTful API
- 前后端分离
- 模板嵌入式部署

## 未来扩展

可能的功能增强：

1. **图表可视化**
   - 交付时间变化趋势图
   - 检查频率统计图
   - 通知效果分析图

2. **高级功能**
   - 手动触发检查
   - 配置在线编辑
   - 数据导出功能

3. **通知管理**
   - 查看通知历史
   - 重新发送通知
   - 通知模板自定义

## 总结

Web 管理界面为理想汽车订单监控系统提供了直观的可视化能力，让您可以：

✅ 实时查看监控状态  
✅ 追踪历史变化记录  
✅ 分析时间变化趋势  
✅ 远程访问监控数据  

无需安装额外软件，只需浏览器即可轻松管理您的订单监控！

---

**更新时间**: 2025-10-23  
**版本**: 1.0.0
